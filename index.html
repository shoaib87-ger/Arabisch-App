<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Dr. Shoaibs Lern-App</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Lern-App">
    <meta name="description" content="Deutsch-Arabisch Lernkarten mit OCR">
    <link rel="manifest" href="manifest.json">

    <!-- Fonts: Preconnect for fast loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Arabic Fonts: Amiri (primary), Scheherazade New (fallback), Noto Naskh (system) -->
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Scheherazade+New:wght@400;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <!-- Tesseract.js (Fallback) -->
    <script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ‘¨â€âš•ï¸ Dr. Shoaibs Lern-App</h1>
            <p>Deutsch â†” Arabisch</p>
        </div>

        <!-- Tab Bar -->
        <div class="tab-bar">
            <div class="tab active" data-tab="categories" onclick="switchTab('categories')">ğŸ“‚ Kategorien</div>
            <div class="tab" data-tab="upload" onclick="switchTab('upload')">ğŸ“¤ Upload</div>
            <div class="tab" data-tab="learn" onclick="switchTab('learn')">ğŸ“š Lernen</div>
        </div>

        <!-- ===== KATEGORIEN TAB ===== -->
        <div id="categories" class="content active">
            <button class="btn btn-primary btn-small mb-md" onclick="openNewCatModal()">+ Neue Kategorie</button>
            <div id="categoryGrid" class="category-grid"></div>
        </div>

        <!-- ===== UPLOAD TAB ===== -->
        <div id="upload" class="content">
            <!-- Upload Hero -->
            <div class="upload-hero">
                <h3>ğŸ“· Foto oder PDF hochladen</h3>
                <p class="subtitle">Lade ein Foto mit Vokabeln hoch â€” wird automatisch erkannt!<br>âœ… JPG, PNG, PDF
                    (mehrere Seiten)</p>

                <input type="file" id="fileInput" accept="image/jpeg,image/png,application/pdf" style="display:none"
                    onchange="handleUpload(this)">

                <div class="upload-buttons">
                    <button class="btn btn-white" onclick="triggerFileUpload()">ğŸ“¸ Datei wÃ¤hlen</button>
                    <button class="btn btn-accent" onclick="openCamera()">ğŸ“· Kamera</button>
                </div>

                <!-- Progress -->
                <div id="progressContainer" class="progress-container">
                    <div id="progressStatus" class="progress-status">ğŸ”„ Initialisiere...</div>
                    <div class="progress-bar-bg">
                        <div id="progressBar" class="progress-bar"></div>
                    </div>
                </div>

                <!-- Preview -->
                <div id="imagePreview" class="image-preview">
                    <img id="previewImg" alt="Vorschau">
                </div>
            </div>

            <!-- Manual Add -->
            <div class="word-form">
                <h3>âœï¸ Manuell hinzufÃ¼gen</h3>
                <input type="text" id="germanWord" class="form-input" placeholder="Deutsches Wort" autocomplete="off">
                <input type="text" id="arabicWord" class="form-input arabic" placeholder="Arabisches Wort"
                    autocomplete="off" dir="rtl">
                <input type="text" id="exampleText" class="form-input" placeholder="Beispiel (optional)"
                    autocomplete="off">
                <button class="btn btn-primary" onclick="addWord()">â• HinzufÃ¼gen</button>
            </div>

            <!-- Quick Category -->
            <div class="quick-category">
                <p>Neue Kategorie benÃ¶tigt?</p>
                <button class="btn btn-secondary btn-small" onclick="openNewCatModal()">â• Neue Kategorie</button>
            </div>

            <!-- Pending Words -->
            <div id="pendingContainer" class="hidden">
                <div class="pending-box">
                    <h3>ğŸ“‹ Bereit (<span id="pendingCount">0</span>)</h3>
                    <div id="pendingList"></div>

                    <div class="direction-box">
                        <h4 style="margin-bottom: 8px; font-size: 14px;">Richtung:</h4>
                        <label class="direction-option">
                            <input type="radio" name="dir" value="de-ar" checked>
                            <span>â¡ï¸ Deutsch â†’ Arabisch (empfohlen)</span>
                        </label>
                        <label class="direction-option">
                            <input type="radio" name="dir" value="ar-de">
                            <span>â¬…ï¸ Arabisch â†’ Deutsch</span>
                        </label>
                        <label class="direction-option">
                            <input type="radio" name="dir" value="both">
                            <span>ğŸ”„ Beides (2Ã— so viele Karten)</span>
                        </label>
                    </div>

                    <label
                        style="display: block; margin-bottom: 5px; font-weight: bold; color: #333; font-size: 14px;">Kategorie:</label>
                    <select id="targetCat"></select>

                    <button class="btn btn-success mt-sm" onclick="createCards()">âœ… Karten erstellen</button>
                </div>
            </div>
        </div>

        <!-- ===== LERNEN TAB ===== -->
        <div id="learn" class="content">
            <div id="learnArea">
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“‚</div>
                    <p>WÃ¤hle eine Kategorie<br>im Kategorien-Tab!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== MODALS ===== -->

    <!-- Edit Category Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h3>ğŸ“ Kategorie bearbeiten</h3>
            <label
                style="display: block; margin-bottom: 5px; font-weight: bold; color: #333; font-size: 14px;">Name:</label>
            <input type="text" id="editName" class="form-input" autocomplete="off">
            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 14px;">Icon
                wÃ¤hlen:</label>
            <div id="editIconPicker" class="icon-picker"></div>
            <button class="btn btn-primary mb-sm" onclick="saveEdit()">âœ… Speichern</button>
            <button class="btn btn-secondary" onclick="closeModal('editModal')">Abbrechen</button>
        </div>
    </div>

    <!-- New Category Modal -->
    <div id="newCatModal" class="modal">
        <div class="modal-content">
            <h3>â• Neue Kategorie erstellen</h3>
            <label
                style="display: block; margin-bottom: 5px; font-weight: bold; color: #333; font-size: 14px;">Name:</label>
            <input type="text" id="newCatName" class="form-input" placeholder="z.B. Kapitel 1, Verben, Medizin..."
                autocomplete="off">
            <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 14px;">Icon
                wÃ¤hlen:</label>
            <div id="newCatIconPicker" class="icon-picker"></div>
            <button class="btn btn-primary mb-sm" onclick="saveNewCat()">âœ… Erstellen</button>
            <button class="btn btn-secondary" onclick="closeModal('newCatModal')">Abbrechen</button>
        </div>
    </div>

    <!-- Scripts (Order matters!) -->
    <script src="preprocessing.js"></script>
    <script src="ocr.js"></script>
    <script src="pdf-handler.js"></script>
    <script src="app.js"></script>
</body>

</html>